{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://dativo.io/schemas/connectors.schema.json",
  "title": "Dativo Connectors Registry",
  "type": "object",
  "required": ["version"],
  "anyOf": [
    { "required": ["connectors"] },
    { "required": ["sources", "targets"] }
  ],
  "properties": {
    "version": { "type": "integer", "minimum": 1 },
    "connectors": {
      "type": "object",
      "minProperties": 1,
      "additionalProperties": { "$ref": "#/$defs/connector" }
    },
    "sources": {
      "type": "object",
      "minProperties": 1,
      "additionalProperties": { "$ref": "#/$defs/sourceConnector" }
    },
    "targets": {
      "type": "object",
      "minProperties": 1,
      "additionalProperties": { "$ref": "#/$defs/targetConnector" }
    }
  },
  "$defs": {
    "engineType": {
      "type": "string",
      "enum": ["airbyte", "singer", "meltano", "native", "jdbc", "spark"]
    },
    "incrementalStrategy": {
      "type": "string",
      "enum": ["updated_after", "updated_at", "created", "file_modified_time", "spreadsheet_modified_time", "cdc"]
    },
    "connector": {
      "type": "object",
      "required": ["roles", "default_engine", "engines_supported"],
      "properties": {
        "roles": {
          "type": "array",
          "items": { "type": "string", "enum": ["source", "target"] },
          "minItems": 1,
          "maxItems": 2
        },
        "category": { "type": "string", "minLength": 1 },
        "default_engine": { "$ref": "#/$defs/engineType" },
        "engines_supported": {
          "type": "array",
          "items": { "$ref": "#/$defs/engineType" },
          "minItems": 1
        },
        "allowed_in_cloud": { "type": "boolean" },
        "supports_incremental": { "type": "boolean" },
        "incremental_strategy_default": { "$ref": "#/$defs/incrementalStrategy" },
        "objects_supported": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 1
        },
        "requires_tables": { "type": "boolean" },
        "supports_queries": { "type": "boolean" },
        "file_formats": {
          "type": "array",
          "items": { "type": "string", "enum": ["parquet", "orc", "csv", "json", "markdown_kv"] },
          "minItems": 1
        },
        "supports_schema_evolution": { "type": "boolean" }
      },
      "additionalProperties": false
    },
    "sourceConnector": {
      "type": "object",
      "required": ["category", "default_engine", "engines_supported", "allowed_in_cloud", "supports_incremental", "incremental_strategy_default"],
      "properties": {
        "category": { "type": "string", "minLength": 1 },
        "default_engine": { "$ref": "#/$defs/engineType" },
        "engines_supported": {
          "type": "array",
          "items": { "$ref": "#/$defs/engineType" },
          "minItems": 1
        },
        "allowed_in_cloud": { "type": "boolean" },
        "supports_incremental": { "type": "boolean" },
        "incremental_strategy_default": { "$ref": "#/$defs/incrementalStrategy" },
        "objects_supported": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 1
        },
        "requires_tables": { "type": "boolean" },
        "supports_queries": { "type": "boolean" }
      },
      "additionalProperties": false
    },
    "targetConnector": {
      "type": "object",
      "required": ["default_engine", "engines_supported"],
      "properties": {
        "default_engine": { "$ref": "#/$defs/engineType" },
        "engines_supported": {
          "type": "array",
          "items": { "$ref": "#/$defs/engineType" },
          "minItems": 1
        },
        "file_formats": {
          "type": "array",
          "items": { "type": "string", "enum": ["parquet", "orc", "csv", "json", "markdown_kv"] },
          "minItems": 1
        },
        "supports_schema_evolution": { "type": "boolean" }
      },
      "additionalProperties": false
    }
  }
}

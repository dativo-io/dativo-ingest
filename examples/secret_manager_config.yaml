# Example Secret Manager Configurations
# 
# This file demonstrates how to configure different secret management backends
# for the Dativo ingestion platform. Choose the backend that best fits your
# infrastructure and security requirements.

# ============================================================================
# ENVIRONMENT VARIABLES (DEFAULT)
# ============================================================================
# The simplest approach - no additional configuration needed
# Just set environment variables and go!

# Example environment setup:
# export SECRET_MANAGER_TYPE="env"
# export ACME_STRIPE_API_KEY="sk_test_123"
# export ACME_PGHOST="localhost"
# export ACME_PGPASSWORD="secret"

env_config:
  type: env
  # Optional configuration
  config:
    prefix: ""              # Optional prefix for all env vars
    uppercase: true         # Convert names to uppercase (default)
    allow_generic: true     # Allow non-tenant-specific fallback (default)

# ============================================================================
# FILESYSTEM (BACKWARD COMPATIBLE)
# ============================================================================
# Original file-based approach, useful for local development
# and backward compatibility with existing setups

# Example filesystem structure:
# /secrets/
#   ├── acme/
#   │   ├── stripe_api_key.txt
#   │   ├── gsheets.json
#   │   └── postgres.env
#   └── other_tenant/
#       └── api_key.txt

filesystem_config:
  type: filesystem
  config:
    secrets_dir: /secrets   # Base directory for secrets

# ============================================================================
# HASHICORP VAULT
# ============================================================================
# Enterprise-grade secret management with dynamic secrets,
# encryption as a service, and fine-grained access control

# Token Authentication (simplest)
vault_token_config:
  type: vault
  config:
    url: https://vault.example.com
    token: s.123456
    mount_point: secret
    kv_version: 2
    path_template: "{tenant}"

# AppRole Authentication (recommended for automated systems)
vault_approle_config:
  type: vault
  config:
    url: https://vault.example.com
    auth_method: approle
    role_id: abc123-def456
    secret_id: xyz789-uvw012
    mount_point: secret
    kv_version: 2
    path_template: "{tenant}"

# Kubernetes Authentication (for K8s deployments)
vault_kubernetes_config:
  type: vault
  config:
    url: https://vault.example.com
    auth_method: kubernetes
    k8s_role: my-app-role
    k8s_token_path: /var/run/secrets/kubernetes.io/serviceaccount/token
    mount_point: secret
    kv_version: 2
    path_template: "{tenant}"

# AWS IAM Authentication (for AWS deployments)
vault_aws_config:
  type: vault
  config:
    url: https://vault.example.com
    auth_method: aws
    aws_role: my-iam-role
    mount_point: secret
    kv_version: 2
    path_template: "{tenant}"

# Vault Enterprise with Namespace
vault_enterprise_config:
  type: vault
  config:
    url: https://vault.example.com
    token: s.123456
    namespace: my-team
    mount_point: secret
    kv_version: 2
    path_template: "{tenant}"

# ============================================================================
# AWS SECRETS MANAGER
# ============================================================================
# Native AWS secret management with automatic rotation,
# fine-grained IAM policies, and CloudWatch integration

# Using Default AWS Credentials (recommended for AWS deployments)
aws_default_config:
  type: aws
  config:
    region_name: us-east-1
    secret_name_template: "{tenant}/secrets"

# Using Explicit Credentials (for testing or cross-account access)
aws_explicit_config:
  type: aws
  config:
    region_name: us-east-1
    secret_name_template: "{tenant}/secrets"
    aws_access_key_id: AKIA...
    aws_secret_access_key: ...

# Using LocalStack for local development
aws_localstack_config:
  type: aws
  config:
    region_name: us-east-1
    secret_name_template: "{tenant}/secrets"
    endpoint_url: http://localhost:4566

# ============================================================================
# GOOGLE CLOUD SECRET MANAGER
# ============================================================================
# Native GCP secret management with automatic encryption,
# audit logging, and fine-grained IAM policies

# Using Application Default Credentials (recommended for GCP deployments)
gcp_default_config:
  type: gcp
  config:
    project_id: my-project
    secret_name_template: "{tenant}-secrets"

# Using Service Account Key File
gcp_service_account_config:
  type: gcp
  config:
    project_id: my-project
    secret_name_template: "{tenant}-secrets"
    credentials_file: /path/to/service-account-key.json

# ============================================================================
# USAGE EXAMPLES
# ============================================================================

# Option 1: Set via environment variable
# export SECRET_MANAGER_TYPE="vault"
# export VAULT_ADDR="https://vault.example.com"
# export VAULT_TOKEN="s.123456"

# Option 2: Set via JSON configuration
# export SECRET_MANAGER_TYPE="aws"
# export SECRET_MANAGER_CONFIG='{"region_name":"us-east-1","secret_name_template":"{tenant}/secrets"}'

# Option 3: Auto-detection (no explicit configuration)
# The system will auto-detect based on:
# - Presence of VAULT_ADDR -> vault
# - Presence of AWS_SECRETS_MANAGER -> aws
# - Presence of GOOGLE_CLOUD_PROJECT -> gcp
# - Existence of /secrets directory -> filesystem
# - Default -> env

# ============================================================================
# ENVIRONMENT-SPECIFIC RECOMMENDATIONS
# ============================================================================

# Development/Testing:
# - Use environment variables or filesystem
# - Simple to set up and iterate quickly
# - No external dependencies

# Staging:
# - Use cloud provider secret managers (AWS/GCP)
# - Test production-like configuration
# - Automatic secret rotation

# Production:
# - Use HashiCorp Vault or cloud provider secret managers
# - Enable audit logging
# - Implement secret rotation
# - Use least-privilege access
# - Enable encryption at rest

# CI/CD:
# - Use environment variables with proper masking
# - Or integrate with existing secret management
# - Never commit secrets to version control

# ============================================================================
# MIGRATION PATHS
# ============================================================================

# From filesystem to environment variables:
# 1. Extract secrets from files: export TENANT_SECRET=$(cat /secrets/tenant/secret.txt)
# 2. Update SECRET_MANAGER_TYPE to "env"
# 3. Test thoroughly
# 4. Remove filesystem secrets

# From filesystem to cloud providers:
# 1. Use CLI tools to import secrets (aws secretsmanager, gcloud secrets, vault kv)
# 2. Update SECRET_MANAGER_TYPE and configuration
# 3. Test thoroughly
# 4. Remove filesystem secrets

# From environment variables to cloud providers:
# 1. Create secrets in cloud provider using environment variable values
# 2. Update SECRET_MANAGER_TYPE and configuration
# 3. Test thoroughly
# 4. Remove environment variables (optional)

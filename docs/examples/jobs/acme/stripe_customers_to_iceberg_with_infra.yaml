# Stripe customers to Iceberg job with external infrastructure management
# This example shows how to reference Terraform-managed AWS Fargate infrastructure

tenant_id: acme
environment: prod

# Reference to source connector recipe
source_connector: stripe
source_connector_path: /app/connectors/stripe.yaml

# Reference to target connector recipe
target_connector: iceberg
target_connector_path: /app/connectors/iceberg.yaml

# Reference to asset definition
asset: stripe_customers
asset_path: /app/assets/stripe/v1.0/customers.yaml

# Source configuration
source:
  objects: [customers]
  incremental:
    lookback_days: 1

# Target configuration
target:
  branch: acme
  warehouse: s3://lake/acme/
  connection:
    nessie:
      uri: "http://nessie.acme.internal:19120/api/v1"
    s3:
      bucket: "acme-data-lake"
      prefix: "raw/stripe/customers"

# Infrastructure configuration (Terraform-managed AWS Fargate)
infrastructure:
  provider: aws
  runtime:
    type: aws_fargate
    image: "123456789012.dkr.ecr.us-east-1.amazonaws.com/dativo:1.1.0"
    cpu: "1024"
    memory: "2048"
  region: us-east-1
  resource_identifiers:
    # These placeholders are replaced with actual Terraform outputs
    cluster_name: "{{terraform_outputs.cluster_name}}"
    task_definition_arn: "{{terraform_outputs.task_definition_arn}}"
    service_name: "{{terraform_outputs.service_name}}"
  tags:
    # Required tags for cost allocation and compliance
    job_name: stripe-customers-etl
    team: data-engineering
    pipeline_type: ingestion
    environment: prod
    cost_center: data-platform

logging:
  redaction: true
  level: INFO
